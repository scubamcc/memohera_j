{% extends "base.html" %}
{% load tz %}
{% load i18n %}

{% block title %}Notifications - Memorial Heritage{% endblock %}

{% block content %}
<div class="container">
    <div class="notifications-container">
        <div class="notifications-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h2><i class="fas fa-bell me-2"></i>Notifications</h2>
                    <p class="text-muted mb-0">Stay updated with your family connections</p>
                </div>
                <div class="col-md-4 text-end">
                    {% if unread_notifications %}
                        <a href="{% url 'mark_all_notifications_read' %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-check-double me-1"></i>Mark All as Read
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>

        {% if unread_notifications or read_notifications %}
            <!-- Unread Notifications -->
            {% if unread_notifications %}
                <div class="notifications-section">
                    <h5 class="section-title">
                        <i class="fas fa-star me-2 text-warning"></i>New Notifications
                        <span class="badge bg-danger ms-2">{{ unread_notifications.count }}</span>
                    </h5>
                    
                    {% for notification in unread_notifications %}
                        <div class="notification-card unread" onclick="window.location.href='{% url 'mark_notification_read' notification.id %}'">
                            <div class="notification-icon {{ notification.notification_type }}">
                                {% if notification.notification_type == 'relationship_suggested' %}
                                    <i class="fas fa-link"></i>
                                {% elif notification.notification_type == 'relationship_approved' %}
                                    <i class="fas fa-check-circle"></i>
                                {% elif notification.notification_type == 'relationship_rejected' %}
                                    <i class="fas fa-times-circle"></i>
                                {% else %}
                                    <i class="fas fa-bell"></i>
                                {% endif %}
                            </div>
                            
                            <div class="notification-content">
                                <div class="notification-title">{{ notification.title }}</div>
                                <div class="notification-message">{{ notification.message }}</div>
                                <div class="notification-meta">
                                    <i class="fas fa-clock me-1"></i>
                                    {{ notification.created_at|timesince }} ago
                                    {% if notification.related_user %}
                                        <span class="ms-2">
                                            <i class="fas fa-user me-1"></i>{{ notification.related_user.username }}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="notification-badge">
                                <span class="badge bg-primary">New</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Read Notifications -->
            {% if read_notifications %}
                <div class="notifications-section">
                    <h5 class="section-title">
                        <i class="fas fa-history me-2"></i>Earlier
                    </h5>
                    
                    {% for notification in read_notifications %}
                        <div class="notification-card read">
                            <div class="notification-icon {{ notification.notification_type }}">
                                {% if notification.notification_type == 'relationship_suggested' %}
                                    <i class="fas fa-link"></i>
                                {% elif notification.notification_type == 'relationship_approved' %}
                                    <i class="fas fa-check-circle"></i>
                                {% elif notification.notification_type == 'relationship_rejected' %}
                                    <i class="fas fa-times-circle"></i>
                                {% else %}
                                    <i class="fas fa-bell"></i>
                                {% endif %}
                            </div>
                            
                            <div class="notification-content">
                                <div class="notification-title">{{ notification.title }}</div>
                                <div class="notification-message">{{ notification.message }}</div>
                                <div class="notification-meta">
                                    <i class="fas fa-clock me-1"></i>
                                    {{ notification.created_at|timesince }} ago
                                    {% if notification.related_user %}
                                        <span class="ms-2">
                                            <i class="fas fa-user me-1"></i>{{ notification.related_user.username }}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

        {% else %}
            <!-- Empty State -->
            <div class="empty-state">
                <i class="fas fa-bell-slash fa-4x mb-3"></i>
                <h4>No Notifications Yet</h4>
                <p class="text-muted">You're all caught up! We'll notify you when something happens.</p>
                <a href="{% url 'browse' %}" class="btn btn-primary mt-3">
                    <i class="fas fa-search me-2"></i>Browse Memorials
                </a>
            </div>
        {% endif %}
    </div>
</div>

<style>
.notifications-container {
    max-width: 900px;
    margin: 2rem auto;
}

.notifications-header {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.notifications-header h2 {
    color: var(--primary-color);
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.notifications-section {
    margin-bottom: 2rem;
}

.section-title {
    color: var(--primary-color);
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e5e7eb;
}

.notification-card {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    transition: all 0.3s;
    cursor: pointer;
    position: relative;
}

.notification-card:hover {
    transform: translateX(5px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border-color: var(--secondary-color);
}

.notification-card.unread {
    background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
    border-left: 4px solid var(--secondary-color);
}

.notification-card.read {
    opacity: 0.8;
}

.notification-icon {
    width: 50px;
    height: 50px;
    min-width: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.notification-icon.relationship_suggested {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
}

.notification-icon.relationship_approved {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.notification-icon.relationship_rejected {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
}

.notification-icon.new_family_member {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.notification-content {
    flex: 1;
}

.notification-title {
    font-weight: 600;
    color: var(--primary-color);
    font-size: 1.05rem;
    margin-bottom: 0.5rem;
}

.notification-message {
    color: #6b7280;
    line-height: 1.6;
    margin-bottom: 0.75rem;
}

.notification-meta {
    font-size: 0.85rem;
    color: #9ca3af;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.notification-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
}

.notification-badge .badge {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.9; }
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.empty-state i {
    color: #d1d5db;
}

.empty-state h4 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

/* Responsive */
@media (max-width: 768px) {
    .notifications-container {
        margin: 1rem auto;
        padding: 0 1rem;
    }
    
    .notifications-header {
        padding: 1.5rem;
    }
    
    .notifications-header .row {
        flex-direction: column;
        gap: 1rem;
    }
    
    .notifications-header .col-md-4 {
        text-align: left !important;
    }
    
    .notification-card {
        padding: 1rem;
        gap: 0.75rem;
    }
    
    .notification-icon {
        width: 40px;
        height: 40px;
        min-width: 40px;
        font-size: 1.2rem;
    }
    
    .notification-title {
        font-size: 0.95rem;
    }
    
    .notification-message {
        font-size: 0.9rem;
    }
}
</style>
{% endblock %}