<!-- templates/memorials/partials/sharing_buttons.html -->
{% load i18n %}

<div class="sharing-section mt-4">
    <h6 class="mb-3">
        <i class="fas fa-share-alt me-2"></i>{% trans "Share this memorial" %}
    </h6>
    
    <div class="d-flex flex-wrap gap-2">
        <!-- Facebook -->
        <button class="btn btn-outline-primary btn-sm share-btn" 
                data-platform="facebook" 
                data-memorial-id="{{ memorial.id }}">
            <i class="fab fa-facebook-f me-1"></i>Facebook
        </button>
        
        <!-- Twitter -->
        <button class="btn btn-outline-info btn-sm share-btn" 
                data-platform="twitter" 
                data-memorial-id="{{ memorial.id }}">
            <i class="fab fa-twitter me-1"></i>Twitter
        </button>
        
        <!-- WhatsApp -->
        <button class="btn btn-outline-success btn-sm share-btn" 
                data-platform="whatsapp" 
                data-memorial-id="{{ memorial.id }}">
            <i class="fab fa-whatsapp me-1"></i>WhatsApp
        </button>
        
        <!-- LinkedIn -->
        <button class="btn btn-outline-dark btn-sm share-btn" 
                data-platform="linkedin" 
                data-memorial-id="{{ memorial.id }}">
            <i class="fab fa-linkedin-in me-1"></i>LinkedIn
        </button>
        
        <!-- Email -->
        <button class="btn btn-outline-secondary btn-sm share-btn" 
                data-platform="email" 
                data-memorial-id="{{ memorial.id }}">
            <i class="fas fa-envelope me-1"></i>Email
        </button>
        
        <!-- Copy Link -->
        <button class="btn btn-outline-warning btn-sm" 
                id="copyLinkBtn" 
                data-memorial-id="{{ memorial.id }}">
            <i class="fas fa-link me-1"></i>{% trans "Copy Link" %}
        </button>
    </div>
    
    <!-- Share count -->
    {% if memorial.share_count > 0 %}
        <small class="text-muted mt-2 d-block">
            <i class="fas fa-eye me-1"></i>
            {% trans "Shared" %} {{ memorial.share_count }} {% trans "times" %}
        </small>
    {% endif %}
</div>

<!-- JavaScript for sharing functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const shareButtons = document.querySelectorAll('.share-btn');
    const copyLinkBtn = document.getElementById('copyLinkBtn');
    
    shareButtons.forEach(button => {
        button.addEventListener('click', function() {
            const platform = this.dataset.platform;
            const memorialId = this.dataset.memorialId;
            
            // Get sharing links from server
            fetch(`/api/memorial/${memorialId}/share-links/`)
                .then(response => response.json())
                .then(data => {
                    if (data.social_links && data.social_links[platform]) {
                        // Open sharing window
                        const shareUrl = data.social_links[platform];
                        
                        if (platform === 'email') {
                            // For email, use mailto: directly
                            window.location.href = shareUrl;
                        } else {
                            // For social platforms, open in popup
                            const popup = window.open(
                                shareUrl,
                                'share',
                                'width=600,height=400,scrollbars=yes,resizable=yes'
                            );
                            
                            // Focus the popup window
                            popup.focus();
                        }
                    }
                })
                .catch(error => {
                    console.error('Error getting share links:', error);
                    alert('Sorry, unable to share at this time.');
                });
        });
    });
    
    // Copy link functionality
    if (copyLinkBtn) {
        copyLinkBtn.addEventListener('click', function() {
            const memorialId = this.dataset.memorialId;
            
            fetch(`/api/memorial/${memorialId}/share-links/`)
                .then(response => response.json())
                .then(data => {
                    if (data.share_url) {
                        // Copy to clipboard
                        navigator.clipboard.writeText(data.share_url)
                            .then(() => {
                                // Show success feedback
                                const originalText = this.innerHTML;
                                this.innerHTML = '<i class="fas fa-check me-1"></i>{% trans "Copied!" %}';
                                this.classList.remove('btn-outline-warning');
                                this.classList.add('btn-success');
                                
                                setTimeout(() => {
                                    this.innerHTML = originalText;
                                    this.classList.remove('btn-success');
                                    this.classList.add('btn-outline-warning');
                                }, 2000);
                            })
                            .catch(() => {
                                // Fallback for older browsers
                                prompt('{% trans "Copy this link:" %}', data.share_url);
                            });
                    }
                })
                .catch(error => {
                    console.error('Error getting share link:', error);
                });
        });
    }
});
</script>

<style>
.sharing-section {
    border-top: 1px solid var(--border-color);
    padding-top: 1rem;
    margin-top: 1rem;
}

.share-btn {
    transition: all 0.2s ease;
}

.share-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
</style>